@page "/my-applications"
@attribute [Authorize]

<PageTitle>Your AI-powered career assistant</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="pa-4">

    @if (_isLoading)
    {
        <WebCV.Web.Components.Shared.LoadingIndicator />
    }
    else if (_applications == null || !_applications.Any())
    {
        <MudAlert Severity="Severity.Info">You haven't generated any applications yet. Go to <MudLink Href="/generate">
                Generate</MudLink> to create one!</MudAlert>
    }
    else
    {
        <MudTable Items="@_applications" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@_isLoading"
            LoadingProgressColor="Color.Info" Filter="new Func<GeneratedApplication,bool>(FilterFunc1)" Dense="true">
            <ToolBarContent>
                <MudText Typo="Typo.h5">📝 My Applications</MudText>
                <MudSpacer />
                <MudTextField @bind-Value="searchString1" Placeholder="Search" Adornment="Adornment.Start"
                    AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Clearable="true"></MudTextField>
            </ToolBarContent>
            <HeaderContent>
                <MudTh>#</MudTh>
                <MudTh>Date</MudTh>
                <MudTh>Company</MudTh>
                <MudTh>Job Title</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="#">@(_applications.IndexOf(context) + 1)</MudTd>
                    <MudTd DataLabel="Date">@context.CreatedDate.ToLocalTime().ToString("g")</MudTd>
                    <MudTd DataLabel="Company">@context.JobPosting?.CompanyName</MudTd>
                    <MudTd DataLabel="Job Title">@context.JobPosting?.Title</MudTd>
                    <MudTd DataLabel="Actions">
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                            OnClick="@(() => ViewApplication(context.Id))" Class="mr-10" Disabled="@(_deletingId == context.Id)"
                            StartIcon="@Icons.Material.Filled.Visibility">View</MudButton>

                        @if (_deletingId == context.Id)
                    {
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Color="Color.Error" />
                    }
                    else
                    {
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                            OnClick="@(() => DeleteApplication(context))" aria-label="delete" Disabled="@(_deletingId != null)">
                        </MudIconButton>
                    }
                </MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    }
</MudContainer>

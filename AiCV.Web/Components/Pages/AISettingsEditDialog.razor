<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-2" />
            @Localizer["EditConfiguration"]
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="3">
            <MudTextField Label="@Localizer["ConfigurationName"]" @bind-Value="UserConfiguration.Name"
                Variant="Variant.Outlined" Margin="Margin.Dense" />

            <MudAutocomplete T="string" Label="@Localizer["Model"]" @bind-Value="UserConfiguration.ModelId"
                Variant="Variant.Outlined" Margin="Margin.Dense" SearchFunc="@SearchModels"
                Clearable="true" CoerceValue="true" />
            
            @{
                var selectedModel = AvailableModels.FirstOrDefault(m => m.ModelId == UserConfiguration.ModelId);
                if (selectedModel != null)
                {
                    <div class="mt-n2 px-1">
                        <div class="d-flex align-center gap-2">
                            <MudChip T="string" Color="@(selectedModel.CostType == "Paid" ? Color.Warning : Color.Success)" 
                                     Size="Size.Small" Variant="Variant.Text" Class="ma-0">
                                @(Localizer[selectedModel.CostType == "Paid" ? "CostTypePaid" : "CostTypeFree"])
                            </MudChip>
                            @if (selectedModel.Notes.Any())
                            {
                                <MudText Typo="Typo.caption" Color="Color.Info" Style="font-style: italic">
                                    @string.Join(", ", selectedModel.Notes)
                                </MudText>
                            }
                        </div>
                    </div>
                }
            }

            <MudTextField Label="@Localizer["ApiKey"]" @bind-Value="UserConfiguration.ApiKey" Variant="Variant.Outlined"
                Margin="Margin.Dense" InputType="@(_showApiKey ? InputType.Text : InputType.Password)"
                Adornment="Adornment.End"
                AdornmentIcon="@(_showApiKey ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff)"
                OnAdornmentClick="() => _showApiKey = !_showApiKey" />
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@Localizer["Cancel"]</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit">@Localizer["Save"]</MudButton>
    </DialogActions>
</MudDialog>
